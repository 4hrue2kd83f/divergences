je_king_louis = {
	icon = "gfx/interface/icons/law_icons/monarchy.dds"

	group = je_group_historical_content

	on_monthly_pulse = {
		events = {
			# Landowners become republicans
			dvg_plantagenia.2
			# dvg_plantagenia comes of age
			dvg_plantagenia.3
		
		}
		random_events = {
			
		}
		effect = {
			if = {
				limit = {
					any_civil_war = {
						civil_war_progress > 0.5
					}
					NOT = { has_variable = je_dvg_plantagenia_civilwar_point }
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = { name = je_dvg_plantagenia_civilwar_point years = 3 }
			}
			if = {
				limit = {
					OR = {
						in_default = yes
						has_modifier = declared_bankruptcy
					}
					NOT = { has_variable = je_dvg_plantagenia_default_point }
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = { name = je_dvg_plantagenia_default_point }
			}
			if = {
				limit = {
					country_rank >= rank_value:great_power
					NOT = { has_variable = je_dvg_plantagenia_gp_point }
				}
				change_variable = { name = plantapoints add = 1 }
				set_variable = { name = je_dvg_plantagenia_gp_point }
			}
		}
	}

	on_weekly_pulse = {
		events = {
			# startup event
			dvg_plantagenia.1
		}
	}

	immediate = {
		set_variable = {
			name = plantapoints
			value = 0
		}
		root = {
			save_scope_as = plantagenia_scope
		}
		ig:ig_intelligentsia = {
			save_scope_as = intelligentsia_ig
		}
	}

	complete = {
		has_law = law_type:law_monarchy
		AND = {
			custom_tooltip = {
				text = je_louis_success
				var:plantapoints > 5
			}
			custom_tooltip = {
				text = dvg_louis_dead
				ruler = {
					NOT = {
						has_variable = is_louis
					}
				}
			}
		}
	}

	on_complete = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		
		
		# Monarchy survives
		trigger_event = {
			id = dvg_plantagenia.7
			popup = yes
		}
	}

	fail = {
		OR = {
			AND = {
				custom_tooltip = {
					text = je_louis_fail
					var:plantapoints <= 0
				}
				ig:ig_landowners = {
					is_marginal = no
				}
				ig:ig_armed_forces = {
					is_marginal = no
				}
			}
			AND = {
				custom_tooltip = {
					text = je_louis_fail_2
					var:plantapoints <= 5
				}
				custom_tooltip = {
					text = dvg_louis_dead
					ruler = {
						NOT = {
							has_variable = is_louis
						}
					}
				}
			}
		}
	}

	on_fail = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		# Monarchy ended by coup
		trigger_event = {
			id = dvg_plantagenia.8
			popup = yes
		}
		show_as_tooltip = {
			if = {
				limit = {
					NOT = { has_law = law_type:law_landed_voting }
				}
				activate_law = law_type:law_landed_voting
			}
			activate_law = law_type:law_presidential_republic
			if = {
				limit = {
					ig:ig_landowners = {
						is_in_government = no
						is_marginal = no
					}
				}
				ig:ig_landowners = {
					add_ruling_interest_group = yes
				}
			}
			if = {
				limit = {
					ig:ig_armed_forces = {
						is_in_government = no
						is_marginal = no
					}
				}
				ig:ig_armed_forces = {
					add_ruling_interest_group = yes
				}
			}
		}
	}

	invalid = {
		NOT = { has_law = law_type:law_monarchy }
	}

	on_invalid = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		if = {
			limit = {
				has_modifier = brz_regency
			}
			remove_modifier = brz_regency
		}
	}

	current_value = {
		value = root.var:plantapoints
	}

	goal_add_value = {
		add = 10
	}

	progressbar = yes

	weight = 100

	can_revolution_inherit = no
	transferable = no
	should_be_pinned_by_default = yes
}

