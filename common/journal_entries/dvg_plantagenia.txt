je_king_louis = {
	icon = "gfx/interface/icons/event_icons/event_broken_crown.dds"

	group = je_group_historical_content

	on_monthly_pulse = {
		events = {
			# Landowners become republicans
			dvg_plantagenia.2
			# dvg_plantagenia comes of age
			dvg_plantagenia.3
			#Visit La Galette
			dvg_plantagenia.12
			#Rebirth of the Fils de Liberte
			dvg_plantagenia.18
			#Louis declining health
			dvg_plantagenia.4
			#Upset Armed Forces
			dvg_plantagenia.6
		}
		random_events = {
			
		}
		effect = {
			if = {
				limit = {
					any_civil_war = {
						civil_war_progress > 0.5
					}
					NOT = { has_variable = je_dvg_plantagenia_civilwar_point }
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = { name = je_dvg_plantagenia_civilwar_point years = 3 }
			}
			if = {
				limit = {
					OR = {
						in_default = yes
						has_modifier = declared_bankruptcy
					}
					NOT = { has_variable = je_dvg_plantagenia_default_point }
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = { name = je_dvg_plantagenia_default_point }
			}
			if = {
				limit = {
					country_rank >= rank_value:great_power
					NOT = { has_variable = je_dvg_plantagenia_gp_point }
				}
				change_variable = { name = plantapoints add = 1 }
				set_variable = { name = je_dvg_plantagenia_gp_point }
			}
			if = {
				limit = {
					has_law = law_type:law_slavery_banned
					NOT = { has_variable = pla_slavery_banned }
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = { name = pla_slavery_banned }
			}
			if = {
				limit = {
					has_variable = recently_lost_war
				}
				change_variable = { name = plantapoints subtract = 1 }
			}
			if = {
				limit = {
					any_interest_group = {
						is_powerful = yes
						law_stance = {
							law = law_type:law_monarchy
							value <= neutral
						}
						ig_approval <= -5
					}
					NOT = {
						has_variable = angry_republicans
					}
				}
				change_variable = { name = plantapoints subtract = 1 }
				set_variable = angry_republicans
			}
			if = {
				limit = {
					ig:ig_intelligentsia = {
						is_powerful = yes
						ig_approval >= 5
					}
					NOT = {
						has_variable = happy_intelligentsia
					}
				}
				change_variable = { name = plantapoints add = 1 }
				set_variable = happy_intelligentsia
			}
			if = {
				limit = {
					ig:ig_rural_folk = {
						is_powerful = yes
						ig_approval >= 5
					}
					NOT = {
						has_variable = happy_intelligentsia
					}
				}
				change_variable = { name = plantapoints add = 1 }
				set_variable = happy_intelligentsia
			}
			if = {
				limit = {
					any_interest_group = {
						OR = {
							is_powerful = no
							law_stance = {
							law = law_type:law_monarchy
							value > neutral
							}
							ig_approval > 5

						}
						
					}
					has_variable = angry_republicans
					
				}
				change_variable = { name = plantapoints add = 1 }
				remove_variable = angry_republicans
			}
			if = {
				limit = {
					owns_entire_state_region = STATE_SANACOMIE
					NOT = {
						has_variable = owns_sanacomie
					}
				}
				change_variable = { name = plantapoints add = 1 }
				set_variable = owns_sanacomie
			}
			
		}
	}

	on_weekly_pulse = {
		events = {
			# startup event
			dvg_plantagenia.1
		}
	}

	immediate = {
		
		root = {
			save_scope_as = plantagenia_scope
		}
		ig:ig_intelligentsia = {
			save_scope_as = intelligentsia_ig
		}
	}

	complete = {
		has_law = law_type:law_monarchy
		AND = {
			custom_tooltip = {
				text = je_louis_success
				var:plantapoints > 5
			}
			custom_tooltip = {
				text = dvg_louis_dead
				ruler = {
					NOT = {
						has_variable = is_louis
					}
				}
			}
		}
	}

	on_complete = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		
		
		# Monarchy survives
		trigger_event = {
			id = dvg_plantagenia.7
			popup = yes
		}
	}

	fail = {
		OR = {
				NOT = { has_law = law_type:law_monarchy }
			AND = {
				custom_tooltip = {
					text = je_louis_fail
					var:plantapoints <= 0
				}
				ig:ig_landowners = {
					is_marginal = no
				}
				any_interest_group = {
					is_powerful = yes
					ig_approval <= -15 
					law_stance = {
						law = law_type:law_monarchy
						value < neutral
					}
				}
				
			}
			AND = {
				custom_tooltip = {
					text = je_louis_fail_2
					var:plantapoints <= 5
				}
				custom_tooltip = {
					text = dvg_louis_dead
					ruler = {
						NOT = {
							has_variable = is_louis
						}
					}
				}
			}
		}
	}

	on_fail = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		# Monarchy ended by coup
		trigger_event = {
			id = dvg_plantagenia.8
			popup = yes
		}
		show_as_tooltip = {
			if = {
				limit = {
					NOT = { has_law = law_type:law_landed_voting }
				}
				activate_law = law_type:law_landed_voting
			}
			activate_law = law_type:law_presidential_republic
			if = {
				limit = {
					ig:ig_landowners = {
						is_in_government = no
						is_marginal = no
					}
				}
				ig:ig_landowners = {
					add_ruling_interest_group = yes
				}
			}
			if = {
				limit = {
					ig:ig_armed_forces = {
						is_in_government = no
						is_marginal = no
						has_ideology = ideology:ideology_caudillismo
					}
				}
				ig:ig_armed_forces = {
					add_ruling_interest_group = yes
				}
			}
			if = {
				limit = {
					OR = {
						ig:ig_intelligentsia = {
							ig_approval <= -10 
							is_marginal = no
						}
						ig:ig_petty_bourgeoisie = {
							ig_approval <= -10 
							is_marginal = no
						}
					}
					
				}
				trigger_event = {
					id = dvg_plantagenia.26
				}
			}
		}
	}

	invalid = {
		NOT = {
			ruler = {
				has_variable = is_louis
			}
		}
		
	}

	on_invalid = {
		hidden_effect = {
			ruler ?= { set_character_immortal = no }
			if = {
				limit = {
					exists = heir
				}
				heir = { set_character_immortal = no }
			}
		}
		if = {
			limit = {
				has_modifier = brz_regency
			}
			remove_modifier = brz_regency
		}
	}

	current_value = {
		value = root.var:plantapoints
	}

	goal_add_value = {
		add = 10
	}
	scripted_button = reform_law_button

	progressbar = yes

	weight = 100

	can_revolution_inherit = no
	transferable = no
	should_be_pinned_by_default = yes
}

je_pla_slavery = {
	icon = "gfx/interface/icons/law_icons/slave_trade.dds"

	group = je_group_internal_affairs

	is_shown_when_inactive = {
		exists = c:PLA
		c:PLA = ROOT
	}
	possible = {
		NOT = {
			has_law = law_type:law_slavery_banned
		}
		has_technology_researched = egalitarianism
		
	}

	immediate = {
		trigger_event = {
			id = dvg_plantagenia.15
		}
		set_variable = {
			name = liberien_var
			value = 0
		}
		
	}
	current_value = {
		value = root.var:liberien_var
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					any_scope_character = {
						has_variable = saint_georges
					}
					this = { var:liberien_var >= 125 }
					NOT = {
						has_variable = saint_georges_raid
					}
				}
				trigger_event =  dvg_plantagenia.28
			}
			if = {
				limit = {
					cu:afro_arcadian = {
						culture_is_discriminated_in = ROOT
					}
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					has_law = law_type:law_slave_trade
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					has_law = law_type:law_legacy_slavery
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					has_technology_researched = anarchism
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					has_technology_researched = human_rights
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					has_technology_researched = labor_movement
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					ruler = {
						law_stance = {
							law = law_type:law_slavery_banned
							value > neutral
						}
					}
				}
				change_variable = {
					name = liberien_var
					subtract = 1
				}
			}
			if = {
				limit = {
					any_scope_character = {
						has_variable = saint_georges
					}
				}
				change_variable = {
					name = liberien_var
					add = 1
				}
			}
			if = {
				limit = {
					OR = {
						has_law = law_type:law_census_voting
						has_law = law_type:law_universal_suffrage
					}
					NOT = {
						has_variable = pla_reform_law_enacted
					}
				}
				trigger_event = {
					id = dvg_plantagenia.5
				}
			}
			
			if = {
				limit = {
					has_law = law_type:law_monarchy
					this = { var:liberien_var >= 50 }
					NOT = {
						has_variable = kings_view
					}
				}
				trigger_event = {
					id = dvg_plantagenia.19
				}
			}
			if = {
				limit = {
					this = { var:liberien_var >= 100 }
					
				}
				trigger_event = {
					id = dvg_plantagenia.34
				}
			}
			if = {
				limit = {
					this = { var:liberien_var >= 150 }
					
				}
				trigger_event = {
					id = dvg_plantagenia.36
				}
			}
			if = {
				limit = {
					NOT = {
						any_scope_character = {
							has_variable = saint_georges
						}
					}
					
				}
				trigger_event = {
					id = dvg_plantagenia.36
				}
			}
		}
	}

	complete = {
		scope:journal_entry = { is_goal_complete = yes }
	}
	on_complete = {
		trigger_event = {
			id = dvg_plantagenia.31
		}
		
	}

	fail = {
		has_law = law_type:law_slavery_banned
	}

	on_fail = {
		if = {
			limit = {
				ruler = {
					has_variable = is_louis
				}
			}
			trigger_event = {
				id = dvg_plantagenia.23
			}
		}
		
	}
	progressbar = yes

	timeout = 10550

	on_timeout = {
		trigger_event = {
			id = dvg_plantagenia.31
		}
	}
	invalid = {
		NOT = {
			any_scope_state = {
				state_region = {
					is_homeland = cu:afro_arcadian
				}	
			}
		}
	}
	goal_add_value = 200
	scripted_button = golden_law_button
	should_be_pinned_by_default = yes
}

je_liberie_independence = {
	icon = "gfx/interface/icons/law_icons/slavery_banned.dds"

	group = je_group_crises

	is_shown_when_inactive = {
		exists = c:LIB
		c:LIB = ROOT
	}
	possible = {
		is_at_war = yes
	}

	immediate = {
		set_country_type = unrecognized
	}
	

	

	complete = {
		is_subject = no
		is_at_war = no
		is_diplomatic_play_committed_participant = no
	}
	on_complete = {
		set_country_type = recognized
		
	}

	fail = {
		
	}

	on_fail = {
		
		
	}
	
	invalid = {
		
	}
	
}

je_unify_planta = {
	icon = "gfx/interface/icons/event_icons/event_empty_chair.dds"

	group = je_group_crises

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					exists = c:OUM
				}
				set_secret_goal = {
					country = c:PLA
					secret_goal = conquer
				}
			}
			if = {
				limit = {
					exists = c:LOU
				}
				set_secret_goal = {
					country = c:LOU
					secret_goal = conquer
				}
			}
		}
	}

	is_shown_when_inactive = {

		
	}

	possible = {
		   
	}

	complete = {
		
		
			custom_tooltip = {
				text = plantagenia_united_tt
				NOT = {
					exists = c:LOU
					exists = c:OUM
				}
			}
	}

	on_complete = {
		
		every_scope_character = {
			limit = {
				has_trait = immortal
			}
			remove_trait = immortal
		}
		trigger_event = {
			id = dvg_plantagenia.27
		}
	}
	should_be_pinned_by_default = yes
	inheritable = no
}


